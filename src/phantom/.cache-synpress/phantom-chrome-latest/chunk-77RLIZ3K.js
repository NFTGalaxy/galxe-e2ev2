import{a as q}from"./chunk-W4Y45LIO.js";import{jc as ae,lc as O,wc as ie}from"./chunk-Q2TGNWPS.js";import{a as C,b as B}from"./chunk-3JCRVFH6.js";import{e as v}from"./chunk-JOOVJERF.js";import{a as oe,b as R}from"./chunk-KK53XKFJ.js";import{a as b}from"./chunk-MN377ENM.js";import{K as X,L as Q,ba as Z,ia as ee,ja as te,ka as re,oa as se}from"./chunk-4HRGOILD.js";import{ae as ne}from"./chunk-4KPHYKUF.js";import{Ac as $,Bc as x,Ec as g,Lc as z,Mc as j,Oc as Y,Rc as k,_c as J,ad as S,zc as W}from"./chunk-ODNNZUPK.js";import{a as G}from"./chunk-L7YPSK2Y.js";import{y}from"./chunk-VAUOTJLY.js";import{a as r,g as I,i as a,j as m,n as i}from"./chunk-NSVULBS3.js";a();i();a();i();a();i();var l;(function(e){e.DismissedActionBanners="dismissedActionBanners",e.AppLaunchTimes="appLaunchTimes",e.LastOnboardedAt="lastOnboardedAt"})(l||(l={}));var ce=[{legacyKeys:[l.DismissedActionBanners],targetSchema:"interstitials",targetKey:l.DismissedActionBanners,migrate:r(e=>e[l.DismissedActionBanners],"migrate")},{legacyKeys:[l.AppLaunchTimes],targetSchema:"interstitials",targetKey:l.AppLaunchTimes,migrate:r(e=>e[l.AppLaunchTimes],"migrate")},{legacyKeys:[l.LastOnboardedAt],targetSchema:"interstitials",targetKey:l.LastOnboardedAt,migrate:r(e=>e[l.LastOnboardedAt],"migrate")}];a();i();var w=I(b());a();i();var fe=r(e=>typeof e=="object"&&e!==null&&"localVersion"in e&&"remoteVersion"in e&&"remoteState"in e&&"eventVersions"in e,"isNamespaceState"),L=r(e=>fe(e)?e:{localVersion:0,remoteVersion:0,remoteState:null,eventVersions:{change:0,idle:0}},"parseNamespaceState");var M=r(e=>typeof e=="object"&&e!==null?e:{},"parseNamespaceItems");var U="mmkv:state:",P="mmkv:items:",D=r(e=>`${U}${e}`,"namespaceStateKey"),F=r(e=>`${P}${e}`,"namespaceItemsKey"),ye=r(e=>e.startsWith(U),"isNamespaceStateKey"),Se=r(e=>e.startsWith(P),"isNamespaceItemsKey"),T=class{static{r(this,"ExtensionBackingStore")}stateCache={};itemsCache={};callbacks={};async init(t){let s=await w.default.storage.local.get([...t.map(o=>D(o.key)),...t.map(o=>F(o.key))]);for(let o of t){let n=o.key,c=D(n),d=F(n);this.stateCache[n]=L(s[c]),this.itemsCache[n]=M(s[d])}w.default.storage.local.onChanged.addListener(o=>{let n=[];for(let[c,d]of Object.entries(o))if(ye(c)){let p=c.slice(U.length);this.stateCache[p]=L(d.newValue),n.push(p)}else if(Se(c)){let p=c.slice(P.length);this.itemsCache[p]=M(d.newValue)}for(let c of n)this.callbacks[c]?.forEach(p=>p(this.stateCache[c]))})}onNamespaceChange(t,s){let o=s,n=this.callbacks[t]??(this.callbacks[t]=[]);return n.push(o),()=>{n.splice(n.indexOf(o),1)}}getNamespace(t){return this.stateCache[t]??null}async setNamespace(t,s){this.stateCache[t]=s,await w.default.storage.local.set({[D(t)]:s})}getItem(t,s,o){let n=`${s}:${o}`;return(this.itemsCache[t]??{})[n]??null}async setItem(t,s,o,n){let c=`${s}:${o}`,d=this.itemsCache[t];d[c]=n,await w.default.storage.local.set({[F(t)]:d})}};a();i();var Re={enabled:!0,clientToken:m.DATADOG_CLIENT_TOKEN,applicationId:"3f3bc3b0-8d80-4b31-b4b9-9909de4d243a",service:"browser-ext-frontend",traceSampleRate:1,sessionSampleRate:1},we={enabled:!0,dsn:"https://pub5df2cf131c51c4215f2ca3aa32d4e4b7@sentry-intake.datadoghq.com/1",sampleRate:.1,tracesSampleRate:0,initialScope:{tags:{service:"browser-ext-background",version:y}}};async function K(e,t){await g.init({appVersion:y,sentry:e==="frontend"?{enabled:!1}:we,datadog:e==="frontend"?Re:{enabled:!1}}),t&&await g.setUser({id:t})}r(K,"initTelemetry");a();i();var _=class{static{r(this,"NetworkLogger")}requests=[];maxRequests=0;allowedDomains=["phantom.app","phantom.com"];ignoredHosts=new Set;ignoredUrls=new Set;ignoredPatterns;init(t={maxRequests:20,ignoredUrls:[],ignoredHosts:[]}){this.maxRequests=t.maxRequests,this.ignoredUrls=new Set(t.ignoredUrls),this.ignoredHosts=new Set(t.ignoredHosts);let s=self.fetch;self.fetch=async(...o)=>{let[n,c]=o,d=c?.method||"GET",p={};if(c?.headers instanceof Headers?c.headers.forEach((h,f)=>{p[f]=h}):Array.isArray(c?.headers)?c.headers.forEach(([h,f])=>{p[h]=f}):p=c?.headers||{},this.shouldIgnoreRequest(n.toString()))return s(...o);let u={id:`${Date.now()}-${Math.random()}`,method:d,url:n.toString(),requestHeaders:p,startTime:Date.now()};this.requests.length>=this.maxRequests&&this.requests.pop(),this.requests.unshift(u);let A=await s(...o),he=await A.clone().text();return u.status=A.status,u.responseHeaders={},A.headers.forEach((h,f)=>{u.responseHeaders[f]=h}),u.endTime=Date.now(),u.response=he,A}}shouldIgnoreRequest(t){try{let s=new URL(t).hostname;return this.ignoredHosts&&this.ignoredHosts.has(s)||this.ignoredUrls&&this.ignoredUrls.has(t)||!this.allowedDomains.some(o=>s.includes(o))?!0:!!(this.ignoredPatterns&&this.ignoredPatterns.some(o=>o.test(t)))}catch{return!0}}getRequests(){return this.requests}clearRequests(){this.requests=[]}setIgnoredHosts(t){this.ignoredHosts=new Set(t)}setIgnoredUrls(t){this.ignoredUrls=new Set(t)}setIgnoredPatterns(t){this.ignoredPatterns=t}clearIgnoredHosts(){this.ignoredHosts=new Set}clearIgnoredUrls(){this.ignoredUrls=new Set}clearIgnoredPatterns(){this.ignoredPatterns=void 0}},Ee=new _,pe=Ee;var E,ft=r(e=>{E?.sendEvent(e)},"sendMMKVUpdateEvent"),N=r(()=>E?.getNamespace(k),"getFlagNamespace"),me=ne(e=>{N()?.updateRemoteState(t=>({overrides:t?.overrides??{},eppoConfig:t?.eppoConfig??{},userId:e})),N()?.invalidate()}),yt=r(()=>{N()?.updateRemoteState(e=>({overrides:e?.overrides??{},eppoConfig:e?.eppoConfig??{},userId:void 0})),N()?.invalidate()},"clearFlagNamespaceUserId"),Ae=r(async(e,t,s)=>{if(E)return;let o={apiKey:J,deviceId:t,subjectAttributes:{appVersion:y,platform:"browser-ext",deviceId:t},pollingEnabled:e==="background",analytics:R,logTelemetry:r(n=>{g.addBreadcrumb(x.FeatureFlags,n,$.Info,{skipFileLogger:!0})},"logTelemetry"),telemetry:g};E=await W({backingStore:new T,namespaces:[k.withDeps(o),j.withDeps({legacyStorage:q,migrations:[...ce]}),Y.withDeps({authRepository:s,legacyStorage:q,migrations:[...v]})],initDeadline:e==="frontend"?0:5e3}),e==="background"&&E.sendEvent("idle")},"initializeMMKV"),St=r(async(e,t)=>{try{let s=await R.getDeviceId();await K(e,s),await Ae(e,s,t),await Ie(),G(s)}catch(s){await K(e),g.captureError(s,x.StartUp)}},"telemetryInitializeFeatureFlags"),Ie=r(()=>{let e=S.getMultivariateAssignment("network-logger-config-json");if(e)try{let t=JSON.parse(e),s=z.parse(t);pe.init({ignoredHosts:s.ignoredHosts,maxRequests:s.maxRequests,ignoredUrls:s.ignoredUrls})}catch(t){console.error("Error initializing network logger",t)}},"initializeNetworkLogging");a();i();var ue=I(b(),1);a();i();var V=I(b(),1);var be=r(async()=>{let e=O("serviceWorkerMutexAcquire",void 0),t=B(await V.default.runtime.sendMessage(C(e)));if("error"in t)throw new Error(t.error.message);return()=>{let s=O("serviceWorkerMutexRelease",void 0);V.default.runtime.sendMessage(C(s))}},"acquire"),le=r(async e=>{let t=await be();try{return await e()}finally{t()}},"runExclusiveWithServiceWorker");a();i();var de=I(b(),1);var ge=r(async(e,t,s)=>{let o=await de.default.identity.launchWebAuthFlow({interactive:s,url:t});if(!re(e,o))return te(e,o);throw new Error("Error fetching auth code")},"fetchExtensionAuthCode");var H=ie(),Te={getClientID:se,redirectURL:ue.default.identity.getRedirectURL(),fetchAuthorizationCode:r((e,t,s)=>ge(e,t,s),"fetchAuthorizationCode")},Ne={storage:new oe,signer:{sign:r((e,t)=>X(H,e,t),"sign"),getAuthenticationPublicKey:r(e=>H.getAuthenticationPublicKey(e),"getAuthenticationPublicKey"),getAllSecretIdentifiers:r(()=>Q(H),"getAllSecretIdentifiers")},authConfig:Te,queryClient:ae,runExclusive:le,isLocalTokenValidityCheckEnabled:r(()=>!S.isFeatureEnabled("kill-frontend-local-check"),"isLocalTokenValidityCheckEnabled"),isServerTimeEnabled:r(()=>!S.isFeatureEnabled("kill-frontend-server-time"),"isServerTimeEnabled")},Ce=ee(Ne);Ce.subscribe(Z.UserID,e=>{R.addUserProperties({authUserId:e}),me(e)});export{pe as a,ft as b,yt as c,St as d,Te as e,Ce as f};
//# sourceMappingURL=chunk-77RLIZ3K.js.map
